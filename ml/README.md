# ML Service - ÐšÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹

Python API Ð´Ð»Ñ ÐºÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¸Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸.

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²

```
ml/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ classifier.pkl    # ÐžÐ±ÑƒÑ‡ÐµÐ½Ð½Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ (RuleBasedClassifier)
â”‚   â”œâ”€â”€ metadata.pkl      # ÐœÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ (feature_columns, category_mapping)
â”‚   â””â”€â”€ rf_model.pkl      # ÐœÐ¾Ð´ÐµÐ»ÑŒ Random Forest (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
â”œâ”€â”€ api.py                # Flask API ÑÐµÑ€Ð²ÐµÑ€
â”œâ”€â”€ requirements.txt      # Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
â”œâ”€â”€ Dockerfile            # Docker ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
â””â”€â”€ README.md            # Ð­Ñ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð»
```

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:
```bash
pip install -r requirements.txt
```

2. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² `models/`:
   - `classifier.pkl`
   - `metadata.pkl`

3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ API:
```bash
# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ñ‡ÐµÑ€ÐµÐ· uvicorn (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
uvicorn api:app --host 0.0.0.0 --port 5000

# Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ñ‡ÐµÑ€ÐµÐ· python (Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ uvicorn Ð²Ð½ÑƒÑ‚Ñ€Ð¸)
python api.py
```

API Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð½Ð° `http://localhost:5000`

**ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ:**
- Swagger UI: `http://localhost:5000/docs`
- ReDoc: `http://localhost:5000/redoc`

### Docker

```bash
docker build -t clarity-ml .
docker run -p 5000:5000 clarity-ml
```

### Docker Compose

```bash
docker compose up ml
```

## ðŸ“¡ API Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹

### 1. Health Check
```http
GET /health
```

**ÐžÑ‚Ð²ÐµÑ‚:**
```json
{
  "status": "ok",
  "model": "RuleBasedClassifier",
  "categories": ["Salary", "Rent", "Transport", "Food", "Shopping", "Misc"],
  "features_count": 14
}
```

### 2. ÐšÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
```http
POST /categorize
Content-Type: application/json

{
  "date": "2023-11-25",
  "amount": 55000.0,
  "ref_no": "CHAS123456"
}
```

**ÐžÑ‚Ð²ÐµÑ‚:**
```json
{
  "category": "Salary",
  "confidence": 0.99
}
```

**ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:**
- `date` - Ð´Ð°Ñ‚Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: YYYY-MM-DD)
- `amount` - ÑÑƒÐ¼Ð¼Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
- `ref_no` - Ñ€ÐµÑ„ÐµÑ€ÐµÐ½ÑÐ½Ñ‹Ð¹ Ð½Ð¾Ð¼ÐµÑ€ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ (reference number Ð¸Ð· Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¾Ð¹ Ð²Ñ‹Ð¿Ð¸ÑÐºÐ¸)

### 3. ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ (Ð½Ð¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚)
```http
POST /predict
Content-Type: application/json

{
  "date": "2023-11-25",
  "amount": 55000.0,
  "ref_no": "CHAS123456"
}
```

**ÐžÑ‚Ð²ÐµÑ‚:**
```json
{
  "success": true,
  "prediction": {
    "category": "Salary",
    "confidence": 0.99,
    "method": "rule",
    "is_rule_based": true
  }
}
```

### 4. ÐŸÐ°ÐºÐµÑ‚Ð½Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ
```http
POST /batch_predict
Content-Type: application/json

[
  {
    "date": "2023-11-25",
    "amount": 55000.0,
    "ref_no": "CHAS123456"
  },
  {
    "date": "2023-11-26",
    "amount": -56.0,
    "ref_no": "3.00E+11"
  }
]
```

### 5. Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¼Ð¾Ð´ÐµÐ»Ð¸
```http
GET /model_info
```

### 6. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
FastAPI Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½ÑƒÑŽ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ:

- **Swagger UI**: `http://localhost:5000/docs`
- **ReDoc**: `http://localhost:5000/redoc`

## ðŸ“Š ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸

- **Salary** - Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°
- **Rent** - ÐÑ€ÐµÐ½Ð´Ð°
- **Transport** - Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚
- **Food** - Ð•Ð´Ð°
- **Shopping** - Ð¨Ð¾Ð¿Ð¿Ð¸Ð½Ð³
- **Misc** - Ð Ð°Ð·Ð½Ð¾Ðµ

## âš™ï¸ ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° ÐºÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸

1. **Salary**: `Amount > 5000` Ð˜Ð›Ð˜ `RefNo ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ "CHAS" AND Amount > 0`
2. **Rent**: `Amount Ð¼ÐµÐ¶Ð´Ñƒ -2000 Ð¸ -15000` Ð˜ `Day <= 7`
3. **Transport**: `Amount Ð² [-3062, -1718, -500, -100, -50, -200]`
4. **Food**: `Amount Ð¼ÐµÐ¶Ð´Ñƒ -500 Ð¸ -10` Ð˜ `Ð½Ðµ Ñ†ÐµÐ»Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾`
5. **Shopping**: `Amount Ð¼ÐµÐ¶Ð´Ñƒ -10000 Ð¸ -100` (ÐµÑÐ»Ð¸ Ð½Ðµ Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚)
6. **Misc**: Ð’ÑÑ‘ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ (Ñ‡ÐµÑ€ÐµÐ· ML Ð¼Ð¾Ð´ÐµÐ»ÑŒ)

## ðŸ”§ Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Go Backend

Go backend Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ `/categorize` Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ñ‚Ð¸Ð¿Ð° `expense`.

**Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð¾Ñ‚ Go:**
```json
{
  "date": "2023-11-25",
  "amount": 100.0,
  "ref_no": "REF123"
}
```

**Ð’Ð°Ð¶Ð½Ð¾:** Ð’ÑÐµ Ñ‚Ñ€Ð¸ Ð¿Ð¾Ð»Ñ (`date`, `amount`, `ref_no`) Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹ Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿Ñ€Ð°Ð²Ð¸Ð» ÐºÐ»Ð°ÑÑÐ¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸.

**Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ ref_no?**
`ref_no` (reference number) - ÑÑ‚Ð¾ Ñ€ÐµÑ„ÐµÑ€ÐµÐ½ÑÐ½Ñ‹Ð¹ Ð½Ð¾Ð¼ÐµÑ€ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð¸Ð· Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¾Ð¹ Ð²Ñ‹Ð¿Ð¸ÑÐºÐ¸. ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÐµÐ³Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»:
- Ð•ÑÐ»Ð¸ `ref_no` ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ "CHAS" â†’ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð° (Salary)
- Ð•ÑÐ»Ð¸ `ref_no` ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ "E+11" â†’ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÐºÐ°Ðº Ð¿Ñ€Ð¸Ð·Ð½Ð°Ðº Ð´Ð»Ñ ML Ð¼Ð¾Ð´ÐµÐ»Ð¸

## ðŸ› ÐžÑ‚Ð»Ð°Ð´ÐºÐ°

ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ API:
```bash
curl http://localhost:5000/health
```

Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ:
```bash
curl -X POST http://localhost:5000/categorize \
  -H "Content-Type: application/json" \
  -d '{"date":"2023-11-25","amount":55000.0,"ref_no":"CHAS123456"}'
```

## âš ï¸ ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ

- ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 1000 Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð² Ð¿Ð°ÐºÐµÑ‚Ð½Ð¾Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ
- Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ñ‚Ñ‹: `YYYY-MM-DD`
- Ð’ÑÐµ ÑÑƒÐ¼Ð¼Ñ‹ Ð² Ñ€ÑƒÐ±Ð»ÑÑ…

